<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Handling Utils</title>
    <script
      src="https://cdn.plot.ly/plotly-2.35.2.min.js"
      charset="utf-8"
    ></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- â”€â”€ Menu Bar â”€â”€ -->
    <div id="menubar">
      <div class="menu-left">
        <div class="menu-dropdown">
          <button class="menu-btn">File</button>
          <div class="menu-content">
            <button onclick="menuOpen()">Open...</button>
            <hr />
            <button onclick="menuSaveState()">Save State...</button>
            <button onclick="menuLoadState()">Load State...</button>
            <hr />
            <button onclick="window.close()">Exit</button>
          </div>
        </div>
        <div class="menu-dropdown">
          <button class="menu-btn">Edit</button>
          <div class="menu-content">
            <button onclick="undoOp()">Undo</button>
            <button onclick="redoOp()">Redo</button>
            <hr />
            <button onclick="clearPipeline()">Clear Pipeline</button>
          </div>
        </div>
        <div class="menu-dropdown">
          <button class="menu-btn">About</button>
          <div class="menu-content">
            <button disabled>dafer-utils v0.1.0</button>
            <button disabled>Rust Data Science Desktop App</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Main Layout â”€â”€ -->
    <div id="main-layout">
      <!-- Left Tab Bar -->
      <div id="tab-bar">
        <button
          class="tab-btn active"
          data-tab="load-preview"
          title="Load & Preview"
        >
          ðŸ“‚
        </button>
        <button class="tab-btn" data-tab="modify" title="Modify">â›­</button>
        <button class="tab-btn" data-tab="visualize" title="Visualize">
          ðŸ“Š
        </button>
      </div>

      <!-- Tab Content -->
      <div id="tab-content">
        <!-- â•â•â• Load & Preview Tab â•â•â• -->
        <div id="tab-load-preview" class="tab-panel active">
          <div class="file-picker">
            <span id="file-path-display">No file loaded</span>
            <button id="btn-browse" onclick="browseFile()">Browse File</button>
          </div>
          <div id="preview-info" class="hidden"></div>
          <div id="preview-table-container" class="hidden">
            <div id="preview-table-wrapper"></div>
          </div>
          <div id="stats-container" class="hidden">
            <strong>Column Statistics</strong>
            <div id="stats-table-wrapper"></div>
          </div>
          <div id="file-metadata" class="hidden"></div>
          <div id="welcome-msg">
            <h2>Welcome to dafer-utils</h2>
            <p>Click 'Browse File' to load a CSV or Parquet file.</p>
            <p>Or use File &gt; Open from the menu bar.</p>
          </div>
        </div>

        <!-- â•â•â• Modify Tab â•â•â• -->
        <div id="tab-modify" class="tab-panel">
          <div id="modify-no-data" class="centered-msg">
            <h2>No data loaded</h2>
            <p>Load a file in the Load & Preview tab first.</p>
          </div>
          <div id="modify-content" class="hidden">
            <div class="modify-toolbar">
              <!-- Pipeline Column -->
              <div class="toolbar-col">
                <strong>Pipeline</strong>
                <hr />
                <div id="pipeline-list" class="pipeline-scroll">
                  <em>No operations yet.</em>
                </div>
                <div class="pipeline-buttons">
                  <button onclick="undoOp()">Undo</button>
                  <button onclick="redoOp()">Redo</button>
                  <button onclick="clearPipeline()">Clear</button>
                </div>
              </div>

              <!-- Operation Builder Column -->
              <div class="toolbar-col">
                <strong>Add Operation</strong>
                <hr />
                <div class="op-builder-scroll">
                  <label
                    >Operation
                    <select id="op-type-select" onchange="onOpTypeChange()">
                      <option value="filter">Filter</option>
                      <option value="sort">Sort</option>
                      <option value="drop_column">Drop Column</option>
                      <option value="rename_column">Rename Column</option>
                      <option value="select_columns">Select Columns</option>
                      <option value="limit">Limit Rows</option>
                      <option value="fill_null">Fill Null</option>
                      <option value="cast_column">Cast Column Type</option>
                      <option value="parse_datetime">Parse Datetime</option>
                    </select>
                  </label>
                  <div id="op-builder-fields"></div>
                </div>
              </div>

              <!-- Export Column -->
              <div class="toolbar-col">
                <strong>Export</strong>
                <hr />
                <label
                  >Format
                  <select id="export-format">
                    <option value="csv">CSV</option>
                    <option value="parquet">Parquet</option>
                  </select>
                </label>
                <button onclick="exportData()">Export...</button>
                <p id="pipeline-count" class="small-text"></p>
              </div>
            </div>

            <hr />
            <div id="modify-table-container"></div>
          </div>
        </div>

        <!-- â•â•â• Visualize Tab â•â•â• -->
        <div id="tab-visualize" class="tab-panel">
          <div id="viz-no-data" class="centered-msg">
            <h2>No data loaded</h2>
            <p>Load a file in the Load & Preview tab first.</p>
          </div>
          <div id="viz-content" class="hidden">
            <div class="viz-controls">
              <label
                >Plot type
                <select id="plot-type-select" onchange="onPlotConfigChange()">
                  <option value="scatter">Scatter</option>
                  <option value="line">Line</option>
                  <option value="bar">Bar</option>
                  <option value="histogram">Histogram</option>
                </select>
              </label>
              <label
                >X
                <select
                  id="plot-x-select"
                  onchange="onPlotConfigChange()"
                ></select>
              </label>
              <label id="hist-bins-label" class="hidden"
                >Bins
                <input
                  type="number"
                  id="hist-bins"
                  value="30"
                  min="5"
                  max="200"
                  onchange="onPlotConfigChange()"
                />
              </label>
            </div>
            <div class="viz-y-controls">
              <span>Y series:</span>
              <div id="y-series-list"></div>
              <div class="y-add-dropdown">
                <button id="btn-add-y" onclick="toggleYDropdown()">
                  + Add Y
                </button>
                <div id="y-dropdown" class="hidden">
                  <div id="y-dropdown-list"></div>
                </div>
              </div>
            </div>
            <hr />
            <button onclick="resetZoom()">Reset Zoom</button>
            <div id="plot-container"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Status Bar â”€â”€ -->
    <div id="statusbar">
      <span id="status-text">Ready</span>
      <span id="pipeline-status"></span>
    </div>

    <script src="app.js"></script>
  </body>
</html>
